<html lang="en">
  <head>
        <meta charset="utf-8">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
        
        <script src="js/d3.v3.min.js"></script>
        <script src="js/radialBarChart.js"></script>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" type="text/css" href="css/data-visualizations.css">
    </head>
<body>
    <div id="intro" class="panel half">
        <h1>The Business of Data Breaches</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lorem mauris, cursus id nisi nec, ultricies tincidunt ante. In volutpat ex odio, sit amet sagittis nibh efficitur ut. Duis non lorem felis. Donec placerat lacinia massa ut pulvinar. Nulla rhoncus massa eu ante pharetra, eu eleifend magna pulvinar. Duis egestas augue vitae nisi laoreet iaculis eget nec elit. Proin vel finibus orci, sed blandit turpis. Phasellus pretium vitae velit a placerat. Nunc et pharetra magna. Sed fermentum a lorem quis scelerisque. Mauris sollicitudin convallis libero ut pulvinar. Sed sagittis ligula sit amet dolor rhoncus lacinia sed in nisl. Nullam at nunc nec neque pellentesque aliquam at et augue.
        </p>
    </div>

    <div id="examine" class="panel sliver info">
        <h2>Let's examine data breaches in an intuitive way, in terms of the number of records compromised.</h2>
    </div>

    <div id="records" class="panel more">
        <div class="visualization full">
            <div id="canvas"></div>
            <div id="canvas2"></div>
        </div>
    </div>

    <div id="money-intro" class="panel less">
        <div class="visualization less">
            <div id="chart"></div>
        </div>

        <div class="information">
            <h3>But how does that relate to money?</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lorem mauris, cursus id nisi nec, ultricies tincidunt ante. In volutpat ex odio, sit amet sagittis nibh efficitur ut. Duis non lorem felis. Donec placerat lacinia massa ut pulvinar. Nulla rhoncus massa eu ante pharetra, eu eleifend magna pulvinar. Duis egestas augue vitae nisi laoreet iaculis eget nec elit.</p>
        </div>
    </div>

    <div id="money-and-records" class="panel less">
        <div class="visualization less">
            <img src="images/streamgraph.png"/>
        </div>

        <div class="information">
            <h3>Let's revisit the size of these losses in terms of what buyers are willing to pay on the black market, on average:</h3>
            <p>The graph at its thickest point represents 1.9B USD in of worth on the black market, and 55M USD at its thinnest.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lorem mauris, cursus id nisi nec, ultricies tincidunt ante. In volutpat ex odio, sit amet sagittis nibh efficitur ut. Duis non lorem felis. Donec placerat lacinia massa ut pulvinar. Nulla rhoncus massa eu ante pharetra. </p>
        </div>
    </div>

    <div id="compromised" class="panel sliver info">
        <h2>So how is this data compromised?</h2>
    </div>

    <div id="data-compromised" class="panel half">
        <div class="visualization less">
            <div id="method-key">
                <div id="accidental" class="section"><p>Accidental</p></div>
                <div id="hacked" class="section"><p>Hacked</p></div>
                <div id="inside_job" class="section"><p>Inside Job</p></div>
                <div id="lost_stolen" class="section"><p>Lost or Stolen</p></div>
                <div id="poor_security" class="section"><p>Poor Security</p></div>
            </div>
            <svg id="healthcare"></svg>
            <svg id="financial"></svg>
            <svg id="web"></svg>
            <svg id="retail"></svg>
            <svg id="tech"></svg>
            <svg id="government"></svg>
            <svg id="academic"></svg>
            <svg id="telecoms"></svg>
        </div>

        <div class="information">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque lorem mauris, cursus id nisi nec, ultricies tincidunt ante. In volutpat ex odio, sit amet sagittis nibh efficitur ut. Duis non lorem felis. Donec placerat lacinia massa ut pulvinar. Nulla rhoncus massa eu ante pharetra. </p>
        </div>
    </div>

    
    <script>
        var stolenData;
        var accidental = 0,
            hacked = 1,
            inside_job = 2,
            lost_stolen = 3,
            poor_security = 4;
        var hackMethods = {
            "healthcare" : [0, 0, 0, 0, 0],
            "financial"  : [0, 0, 0, 0, 0],
            "web" : [0, 0, 0, 0, 0],
            "retail" : [0, 0, 0, 0, 0],
            "tech" : [0, 0, 0, 0, 0],
            "government" : [0, 0, 0, 0, 0],
            "academic" : [0, 0, 0, 0, 0],
            "telecoms" : [0, 0, 0, 0, 0],
        };
        var colors     = ["aqua", "aquamarine",       "blue",  "blueviolet", "CadetBlue",     "Coral",   "DarkViolet",   "DeepPink",     "Gold",      "Tan",   "StaleGray",   "Salmon", "Red"];
        var categories = [ "web",     "retail", "healthcare",   "transport",      "tech", "financial",   "government",     "energy", "academic", "telecoms",      "gaming", "military", "media"];

        d3.json("data/StolenData.json", function (error, data) {
            //First Graph ranging to all stolen records
            stolenData = data;

            var maxRecords = d3.max(stolenData, 
            function (d) {
                return d.StolenRecords;
            });

            var maxYear = d3.max(stolenData, 
            function (d) {
                return d.Year;
            });

            var minYear = d3.min(stolenData, 
            function (d) {
                return d.Year;
            });

            var svg = d3.select("#canvas").append("svg")
            .attr("height", 400)
            .attr("width", 900);

            var xScale = d3.scale.linear().domain([minYear - 1,maxYear + 1])
            .range([100, 870]);
            var yScale = d3.scale.linear().domain([0, maxRecords]).range([370,30]);
            
            var xAxis = d3.svg.axis().scale(xScale)
            .orient("bottom");
            var yAxis = d3.svg.axis().scale(yScale)
            .orient("left");
            
            svg.append("g").attr("class", "axis")
            .attr("transform", "translate(0,370)")
            .call(xAxis);
            svg.append("g").attr("class", "axis")
            .attr("transform", "translate(" + 100 + ",0)")
            .call(yAxis);
            
            var contents = svg.append("g");
            
            var circles = svg.selectAll("circle").data(stolenData)
                .enter().append("circle");
            
            circles.attr("cx", function(d) { return xScale(d.Year + d.Name.charCodeAt(0) / 128) })
                .attr("cy", function(d) { return yScale(d.StolenRecords) })
                .attr("r", 10)
                .attr("opacity", 0.3)
                .style("fill", function (d) {return colors[categories.indexOf(d.Category)]});

            //Second graph from only 1 to 1,000,000 records
            var svg2 = d3.select("#canvas2").append("svg")
            .attr("height", 400)
            .attr("width", 900);

            var xScale2 = d3.scale.linear().domain([minYear - 1,maxYear + 1])
            .range([100, 870]);
            var yScale2 = d3.scale.linear().domain([0, 1000000]).range([370,30]);
            
            var xAxis2 = d3.svg.axis().scale(xScale2)
            .orient("bottom");
            var yAxis2 = d3.svg.axis().scale(yScale2)
            .orient("left");
            
            svg2.append("g").attr("class", "axis")
            .attr("transform", "translate(0,370)")
            .call(xAxis2);
            svg2.append("g").attr("class", "axis")
            .attr("transform", "translate(" + 100 + ",0)")
            .call(yAxis2);
            
            var contents2 = svg2.append("g");
            
            var circles2 = svg2.selectAll("circle").data(stolenData)
                .enter().append("circle");
            
            circles2.attr("cx", function(d) { return xScale2(d.Year + d.Name.charCodeAt(0) / 128) })
                .attr("cy", function(d) { return yScale2(d.StolenRecords) })
                .attr("r", 10)
                .attr("opacity", 0.3)
                .style("fill", function (d) {return colors[categories.indexOf(d.Category)]});
        });

        //Code for radial bar graph
        d3.json('data/BMPrice.json', function(err, data) {
            var chart = radialBarChart()
            .barHeight(220)
            .reverseLayerOrder(true)
            .capitalizeLabels(true)
            .barColors(['#B66199', '#9392CB', '#76D9FA'])
            .domain([0,35])
            .colorLabels(true)
            .tickValues([5,10,15,20,25,30])
            .tickCircleValues([5,10,15,20,25,30]);

          d3.select('#chart')
            .datum(data)
            .call(chart);
        });

        // Fourth graph
        d3.json("data/StolenData.json", function (error, data) {
            setMethodValues();

            createBar(hackMethods.healthcare, "healthcare");
            createBar(hackMethods.financial, "financial");
            createBar(hackMethods.web, "web");
            createBar(hackMethods.retail, "retail");
            createBar(hackMethods.tech, "tech");
            createBar(hackMethods.government, "government");
            createBar(hackMethods.academic, "academic");
            createBar(hackMethods.telecoms, "telecoms");

            function getTotalMethodCount(data) {
                return data.accidental + data.hacked + data.inside_job + data.lost_stolen + data.poor_security;
            }

            function setMethodValues() {
                for (var i = 0; i < stolenData.length; i++) {
                    updateHelper(stolenData[i]);
                };
            }

            function updateHelper(stolenDataOfI) {
                switch (stolenDataOfI.Category) {
                    case "healthcare":
                        updateCount(hackMethods.healthcare, stolenDataOfI.Method);
                        break;
                    case "financial":
                        updateCount(hackMethods.financial, stolenDataOfI.Method);
                        break;
                    case "web":
                        updateCount(hackMethods.web, stolenDataOfI.Method);
                        break;
                    case "retail":
                        updateCount(hackMethods.retail, stolenDataOfI.Method);
                        break;
                    case "tech":
                        updateCount(hackMethods.tech, stolenDataOfI.Method);
                        break;
                    case "government":
                        updateCount(hackMethods.government, stolenDataOfI.Method);
                        break;
                    case "academic":
                        updateCount(hackMethods.academic, stolenDataOfI.Method);
                        break;
                    case "telecoms":
                        updateCount(hackMethods.telecoms, stolenDataOfI.Method);
                        break;
                }
            }

            function updateCount(hackMethodsValue, method) {
                switch (method) {
                    case "accidental":
                        hackMethodsValue[accidental] += 1;
                        break;
                    case "hacked":
                        hackMethodsValue[hacked] += 1;
                        break;
                    case "inside_job":
                        hackMethodsValue[inside_job] += 1;
                        break;
                    case "lost_stolen":
                        hackMethodsValue[lost_stolen] += 1;
                        break;
                    case "poor_security":
                        hackMethodsValue[poor_security] += 1;
                        break;
                    default:
                        console.log("I encountered something I haven't seen before");
                }
            }

            function createBar(data, id) {
                var width = 50,
                    barHeight = 20;

                var x = d3.scale.linear()
                    .domain([0, d3.max(data)])
                    .range([0, width]);

                var chart = d3.select("#" + id)
                    .attr("width", width)
                    .attr("height", barHeight * data.length);

                var bar = chart.selectAll("g")
                    .data(data)
                  .enter().append("g")
                    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

                bar.append("rect")
                    .attr("width", x)
                    .attr("height", barHeight - 1)
                    .attr("fill", function(d, i) {
                        return graphFourColors[i];
                    });

                bar.append("text")
                    .attr("x", function(d) { return x(d) + 3; })
                    .attr("y", barHeight / 2)
                    .attr("dy", ".35em")
                    .text(function(d) { return d; });

                chart.append("text")    
                    .attr("x", 0)
                    .attr("y", barHeight * 5 + 10)
                    .attr("dy", ".35em")
                    .text(id);
           }
        });

        var graphFourColors = ["Salmon", "Coral", "Gold", "Tan", "Gray"];

        // Fourth graph's key
        document.getElementById("accidental").style.backgroundColor = graphFourColors[accidental];
        document.getElementById("hacked").style.backgroundColor = graphFourColors[hacked];
        document.getElementById("inside_job").style.backgroundColor = graphFourColors[inside_job];
        document.getElementById("lost_stolen").style.backgroundColor = graphFourColors[lost_stolen];
        document.getElementById("poor_security").style.backgroundColor = graphFourColors[poor_security];

    </script>

</body>
</html>